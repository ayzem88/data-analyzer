# -*- coding: utf-8 -*-
"""
محلل الكتب الشامل - المحلل الرئيسي
يحفظ جميع النتائج في ملفات txt
"""

import os
import json
from datetime import datetime

# استيراد جميع الوحدات
from معالج_النصوص import معالج_النصوص
from محلل_الكلمات import محلل_الكلمات
from محلل_المركبات import محلل_المركبات
from مستخرج_الكيانات import مستخرج_الكيانات
from منشئ_التقرير_التفاعلي import منشئ_التقرير_التفاعلي

class محلل_الكتب_الشامل:
    def __init__(self, مجلد_المدونة="المدونة", ملف_كلمات_الإيقاف="stop_words.txt"):
        self.مجلد_المدونة = مجلد_المدونة
        self.ملف_كلمات_الإيقاف = ملف_كلمات_الإيقاف
        self.مجلد_النتائج = "نتائج_التحليل"
        self.إنشاء_مجلد_النتائج()
        
    def إنشاء_مجلد_النتائج(self):
        """إنشاء مجلد للنتائج إذا لم يكن موجوداً"""
        if not os.path.exists(self.مجلد_النتائج):
            os.makedirs(self.مجلد_النتائج)
    
    def حفظ_في_ملف(self, اسم_الملف, محتوى):
        """حفظ المحتوى في ملف txt"""
        مسار_الملف = os.path.join(self.مجلد_النتائج, f"{اسم_الملف}.txt")
        with open(مسار_الملف, 'w', encoding='utf-8') as ملف:
            ملف.write(محتوى)
        print(f"تم حفظ: {مسار_الملف}")
    
    def حفظ_قائمة_في_ملف(self, اسم_الملف, قائمة_البيانات, تنسيق="مفتاح: قيمة"):
        """حفظ قائمة من البيانات في ملف txt"""
        محتوى = ""
        for عنصر in قائمة_البيانات:
            if تنسيق == "مفتاح: قيمة":
                محتوى += f"{عنصر[0]}: {عنصر[1]}\n"
            elif تنسيق == "عنصر_واحد":
                محتوى += f"{عنصر}\n"
            elif تنسيق == "مركب":
                محتوى += f"{' '.join(عنصر)}\n"
        
        self.حفظ_في_ملف(اسم_الملف, محتوى)
    
    def تشغيل_التحليل_الكامل(self):
        """تشغيل جميع مراحل التحليل"""
        print("=== بدء التحليل الشامل للكتب ===")
        
        # 1. معالجة النصوص
        print("\n1. معالجة النصوص...")
        معالج_النصوص_كائن = معالج_النصوص(self.مجلد_المدونة)
        معالج_النصوص_كائن.معالجة_جميع_الملفات()
        
        # 2. تحليل الكلمات
        print("\n2. تحليل الكلمات...")
        محلل_الكلمات_كائن = محلل_الكلمات(self.مجلد_المدونة, self.ملف_كلمات_الإيقاف)
        محلل_الكلمات_كائن.تحليل_الكلمات_الكامل()
        
        # 3. تحليل المركبات
        print("\n3. تحليل المركبات...")
        محلل_المركبات_كائن = محلل_المركبات(self.مجلد_المدونة, self.ملف_كلمات_الإيقاف)
        محلل_المركبات_كائن.تحليل_المركبات_الكامل()
        
        # 4. استخراج الكيانات
        print("\n4. استخراج الكيانات المسماة...")
        مستخرج_الكيانات_كائن = مستخرج_الكيانات(self.مجلد_المدونة)
        مستخرج_الكيانات_كائن.استخراج_جميع_الكيانات()
        
        # 5. إنشاء التقرير النهائي
        print("\n5. إنشاء التقرير النهائي...")
        self.إنشاء_التقرير_النهائي()
        
        # 6. إنشاء التقرير التفاعلي
        print("\n6. إنشاء التقرير التفاعلي...")
        منشئ_التقرير = منشئ_التقرير_التفاعلي(self.مجلد_النتائج)
        منشئ_التقرير.إنشاء_التقرير_الكامل()
        
        print("\n=== اكتمل التحليل الشامل ===")
    
    def إنشاء_التقرير_النهائي(self):
        """إنشاء تقرير نهائي شامل"""
        تقرير = f"""
=== تقرير التحليل الشامل للكتب ===
تاريخ التحليل: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
مجلد المدونة: {self.مجلد_المدونة}

=== الملفات المُنشأة ===
1. ملفات معالجة النصوص:
   - نصوص_مُعالجة.txt
   - تقرير_التنظيف.txt

2. ملفات تحليل الكلمات:
   - جميع_الكلمات.txt
   - الكلمات_الفريدة.txt
   - تكرار_الكلمات.txt
   - طول_الكلمات.txt
   - إحصائيات_الكلمات.txt

3. ملفات تحليل المركبات:
   - المركبات_الثنائية.txt
   - المركبات_الثلاثية.txt
   - تكرار_المركبات_الثنائية.txt
   - تكرار_المركبات_الثلاثية.txt
   - المركبات_المختارة_تركيبياً.txt
   - إحصائيات_المركبات.txt

4. ملفات الكيانات المسماة:
   - الأسماء_والأعلام.txt
   - الدول_والمدن.txt
   - المؤسسات_والمنظمات.txt
   - التواريخ_والأماكن.txt

=== ملاحظات ===
- جميع النتائج محفوظة في مجلد: {self.مجلد_النتائج}
- تم استخدام كلمات الإيقاف من: {self.ملف_كلمات_الإيقاف}
- التحليل شامل لجميع ملفات txt في مجلد المدونة
"""
        
        self.حفظ_في_ملف("التقرير_النهائي", تقرير)

# تشغيل المحلل
if __name__ == "__main__":
    محلل = محلل_الكتب_الشامل()
    محلل.تشغيل_التحليل_الكامل()
